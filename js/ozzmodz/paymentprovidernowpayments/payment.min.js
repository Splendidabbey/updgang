var OzzModz=window.OzzModz||{};OzzModz.NowPayments=OzzModz.NowPayments||{};OzzModz.$=OzzModz.$||window.jQuery||null;
(function(k,g){var h=OzzModz.$;"use strict";OzzModz.NowPayments.CurrencyForm=XF.Element.newHandler({options:{apiKey:null,apiUrl:null,payAmount:".js-nowPaymentsCurrencyAmount",cost:0,currency:null},select:null,payAmount:null,init:function(){var a=this.target||this.$target.get(0);(this.select=a.querySelector('select[name="pay_currency"]'))?(this.payAmount=a.querySelector(this.options.payAmount),"function"!==typeof XF.on?(h(this.select).on("change",this.change.bind(this)),h(g).on("ajax:send",this.beforeAjaxSend.bind(this))):
(XF.on(this.select,"change",this.change.bind(this)),XF.on(g,"ajax-submit:response",this.beforeAjaxSend.bind(this)))):console.log("No currency input")},change:function(){var a=this;XF.ajax("get",this.options.apiUrl+"/v1/estimate",{amount:this.options.cost,currency_from:this.options.currency,currency_to:this.select.value},function(c){a.payAmount.textContent=c.pay_amount},{skipDefault:!0,headers:{"x-api-key":this.options.apiKey,accept:"application/json"},crossDomain:!0})},beforeAjaxSend:function(a,c,
b){c.url&&(b=c);b.url&&(a=b.url.startsWith(this.options.apiUrl))&&a[0]&&(b.url=b.url.replace(RegExp("callback=[^&]*&","gm"),""),b.url=b.url.replaceAll(RegExp("(&(?:_xfRequestUri=[^&]*|_xfWithData=[^&]*|_xfToken=[^&]*|_xfResponseType=[^&]*)\\b)+","gm"),""))}});OzzModz.NowPayments.PaymentForm=XF.Element.newHandler({options:{apiKey:null,apiUrl:null,returnUrl:null,paymentId:0,expirationSeconds:0,expirationUrl:null,timerBlock:".js-nowPaymentsTimer",payAmount:".js-nowPaymentsPayAmount"},timeLeft:null,timerBlock:null,
payAmount:null,countdown:null,init:function(){var a=this.target||this.$target.get(0);this.options.expirationSeconds&&(this.timerBlock=a.querySelector(this.options.timerBlock))&&this.updateCountdown();this.updatePaymentStatus();this.payAmount=a.querySelector(this.options.payAmount)},updateCountdown:function(){var a=this.options.expirationSeconds;if(!(0>=a)){var c=a,b,d,e=this;this.countdown=setInterval(function(){b=parseInt(c/60,10);d=parseInt(c%60,10);b=10>b?"0"+b:b;d=10>d?"0"+d:d;e.timerBlock.textContent=
b+":"+d;0>--c&&(c=a,e.updateEstimate())},1E3)}},updateEstimate:function(){var a=this;XF.ajax("get",this.options.expirationUrl,{payment_id:a.options.paymentId},function(c){c.pay_amount&&(a.payAmount.textContent=c.pay_amount,XF.activate(a.payAmount))},{skipDefaultSuccess:!0})},updatePaymentStatus:function(){var a=this,c=this.target||this.$target.get(0);setInterval(function(){XF.ajax("get",c.action,{as_message:!0,payment_id:a.options.paymentId},function(b){if("ok"===b.status&&b.message){var d=c.querySelector(".js-nowPaymentsStatusContainer"),
e=c.querySelector(".js-nowPaymentsSuccess"),f=c.querySelector(".js-nowPaymentsError");"error"===b.statusBlock?(e&&e.classList.add("u-hidden"),d&&d.classList.remove("u-hidden"),f&&(f.classList.remove("u-hidden"),f.innerHTML=b.message),a.options.expirationSeconds=0,clearInterval(a.countdown)):"error"===b.statusBlock&&(f&&f.classList.add("u-hidden"),d&&d.classList.remove("u-hidden"),e&&(e.classList.remove("u-hidden"),e.innerHTML=b.message),a.options.expirationSeconds=0,clearInterval(a.countdown))}b.redirect&&
XF.redirect(b.redirect)},{skipDefault:!0})},1E4)}});XF.Element.register("now-payments-currency-form","OzzModz.NowPayments.CurrencyForm");XF.Element.register("now-payments-payment-form","OzzModz.NowPayments.PaymentForm")})(window,document);